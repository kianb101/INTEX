<%- include('../partials/head') %>
<%- include('../partials/header') %>

<body>
<script>
    $(document).ready(function() {
        $(".search").keyup(function() {
            var searchTerm = $(".search").val();
            var listItem = $('.results tbody').children('tr');
            var searchSplit = searchTerm.replace(/ /g, "'):containsi('")

            $.extend($.expr[':'], {
                'containsi': function(elem, i, match, array) {
                    return (elem.textContent || elem.innerText || '').toLowerCase().indexOf((match[3] || "").toLowerCase()) >= 0;
                }
            });

            $(".results tbody tr").not(":containsi('" + searchSplit + "')").each(function(e) {
                $(this).attr('visible', 'false');
            });

            $(".results tbody tr:containsi('" + searchSplit + "')").each(function(e) {
                $(this).attr('visible', 'true');
            });

            var jobCount = $('.results tbody tr[visible="true"]').length;
            $('.counter').text(jobCount + ' item');

            if (jobCount == '0') {
                $('.no-result').show();
            } else {
                $('.no-result').hide();
            }
        }); // key up
    });

    // document.addEventListener('DOMContentLoaded', function () {
    //     const searchInput = document.getElementById('searchInput');
    //     const dataTable = document.getElementById('dataTable');
    //     const rows = dataTable.getElementsByTagName('tr');

    //     searchInput.addEventListener('input', function () {
    //         const searchTerm = searchInput.value.toLowerCase();

    //         for (let i = 1; i < rows.length; i++) {
    //             const row = rows[i];
    //             const cells = row.getElementsByTagName('td');
    //             let found = false;

    //             for (let j = 0; j < cells.length; j++) {
    //                 const cellText = cells[j].innerText.toLowerCase();

    //                 if (cellText.includes(searchTerm)) {
    //                     found = true;
    //                     break;
    //                 }
    //             }

    //             if (found) {
    //                 row.style.display = '';
    //             } else {
    //                 row.style.display = 'none';
    //             }
    //         }
    //     });
    // });
</script>
    <div>
        <!-- <div class="account">
            <h1>All Survey Results</h1>
            <form action="/search" method="get">
                <h3>Search for survey entries</h3>
                <input type="number" id="searchInput" name="id" placeholder="Search for Survey ID">
                <button class="btn btn-secondary" id="login-btn">Search</button>
            </form>
        </div> -->
        <div class="form-group">
            <input type="text" class="search form-control" id="small-search" placeholder="Search...">
        </div>
        <span class="counter"></span>
        <!-- <div class="container" id="table-container"> -->
            <!-- TODO: fix styling of this table -->
            <!-- TODO: add drop down to select survey id and filter by that ID -->
            <table class="table table-hover table-bordered results" style="white-space: normal; word-wrap: break-word;">
                <thead style="background-color: #419F42; color: white;">
                    <tr>
                        <th style="text-align: center;">Survey ID</th>
                        <th style="text-align: center;">Date</th>
                        <th style="text-align: center;">Time</th>
                        <th style="text-align: center;">Location</th>
                        <th style="text-align: center;">Age</th>
                        <th style="text-align: center;">Gender</th>
                        <th style="text-align: center;">Relationship</th>
                        <th style="text-align: center;">Occupation</th>
                        <th style="text-align: center;">Uses Social Media?</th>
                        <th style="text-align: center;">Avg Time Used</th>
                        <th style="text-align: center;">Used Without Purpose</th>
                        <th style="text-align: center;">Freq of Distration</th>
                        <th style="text-align: center;">Freq of Restlessness</th>
                        <th style="text-align: center;">Overall Distraction</th>
                        <th style="text-align: center;">Freq of Worry</th>
                        <th style="text-align: center;">Concentration</th>
                        <th style="text-align: center;">Comparison Freq</th>
                        <th style="text-align: center;">Feelings of Comparison</th>
                        <th style="text-align: center;">Seeking Validation</th>
                        <th style="text-align: center;">Feeling Depressed</th>
                        <th style="text-align: center;">Fluctuated Interest</th>
                        <th style="text-align: center;">Sleep Issues</th>                        
                    </tr>
                    <tr class="warning no-result">
                        <td colspan="22"><i class="fa fa-warning" ></i> No result</td>
                    </tr>
                </thead>
                <tbody>
                    <% for (let iCount = 0; iCount < entries.length; iCount++) { %>
                       <tr>
                        <td style="text-align: center;"><%= entries[iCount].survey_id %></td>
                        <td style="text-align: center;"><%= entries[iCount].date %></td>
                        <td style="text-align: center;"><%= entries[iCount].time %></td>
                        <td style="text-align: center;"><%= entries[iCount].location %></td>
                        <td style="text-align: center;"><%= entries[iCount].age %></td>
                        <td style="text-align: center;"><%= entries[iCount].gender %></td>
                        <td style="text-align: center;"><%= entries[iCount].rel_status %></td>
                        <td style="text-align: center;"><%= entries[iCount].occ_status %></td>
                        <td style="text-align: center;"><%= entries[iCount].sm_user %></td>
                        <td style="text-align: center;"><%= entries[iCount].avg_time %></td>
                        <td style="text-align: center;"><%= entries[iCount].wop_freq %></td>
                        <td style="text-align: center;"><%= entries[iCount].distract_freq %></td>
                        <td style="text-align: center;"><%= entries[iCount].restless_freq %></td>
                        <td style="text-align: center;"><%= entries[iCount].const_distract %></td>
                        <td style="text-align: center;"><%= entries[iCount].worried_freq %></td>
                        <td style="text-align: center;"><%= entries[iCount].concen_diff %></td>
                        <td style="text-align: center;"><%= entries[iCount].comp_freq %></td>
                        <td style="text-align: center;"><%= entries[iCount].comp_feel %></td>
                        <td style="text-align: center;"><%= entries[iCount].val_freq %></td>
                        <td style="text-align: center;"><%= entries[iCount].dep_freq %></td>
                        <td style="text-align: center;"><%= entries[iCount].int_fluc %></td>
                        <td style="text-align: center;"><%= entries[iCount].slp_issues %></td>
                       </tr>
                    <% } %>
                </tbody>
            </table>
        <!-- </div> -->
    </div>
</body>

<%- include('../partials/footer') %>